<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n">

<div metal:use-macro="load: layout.pt">
  <div metal:fill-slot="content">
    <div class="container-fluid">
      <h1>${title} <small>Project Tracking</small></h1>
      <p>
        <ol class="breadcrumb">
          <li><a href="${request.route_url('home')}"><span class="glyphicon glyphicon-home" aria-hidden="true"></span> Home</a></li>
          <li><a href="${request.route_url('help')}"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> Getting started</a></li>
          <li class="active"></li>
        </ol>
      </p>
      <h2>${subtitle}</h2>
      <div class='alert alert-danger' tal:condition="error">
          <p>
              Error! ${error}
          </p>
      </div>
      <div class='alert alert-success' tal:condition="info">
          <p>
              Success! ${info}
          </p>
      </div>
      <div class="modal hide" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false">
          <div class="modal-header">
              <h1>Processing...</h1>
          </div>
          <div class="modal-body">
              <div class="progress progress-striped active">
                  <div class="bar" style="width: 100%;"></div>
              </div>
          </div>
      </div>

      <ul class="nav nav-tabs" role="tablist" id="project-tabs">
        <li role="presentation" class="active"><a role="tab" data-toggle="tab" aria-controls="overview" href="#overview">Overview</a></li>
        <li role="presentation"><a role="tab" data-toggle="tab" aria-controls="setup" href="#setup">Setup</a></li>
        <li role="presentation"><a role="tab" data-toggle="tab" aria-controls="reads" href="#reads">Reads</a></li>
        <li role="presentation"><a role="tab" data-toggle="tab" aria-controls="variants" href="#variants">Variants</a></li>
        <li role="presentation"><a role="tab" data-toggle="tab" aria-controls="scores" href="#scores">Scores</a></li>
      </ul>

      <div class="tab-content">
        <!-- Overview section ********************************************** -->
        <div role="tabpanel" class="tab-pane fade in active" id="overview" >
          <h3>Overview</h3>
          <h4>Project Details</h4>
          <table id="projecttable" class="table table-bordered table-condensed">
              <thead>
                  <th tal:repeat="header project_headers">${header}</th>
              </thead>
              <tr tal:repeat="row project_rows">
                  <td tal:repeat="cell row">${cell}</td>
              </tr>
          </table>

          <h4>Targets</h4>
          <table id="targettable" class="table table-bordered table-hover table-condensed">
              <thead>
                  <th tal:repeat="header target_headers">${header}</th>
              </thead>
              <tr tal:repeat="row target_rows">
                  <td tal:repeat="cell row">${cell}</td>
              </tr>
          </table>

          <h4>Guides</h4>
          <table id="guidetable" class="table table-bordered table-hover table-condensed">
              <thead>
                  <th tal:repeat="header guide_headers">${header}</th>
              </thead>
              <tr tal:repeat="row guide_rows">
                  <td tal:repeat="cell row">${cell}</td>
              </tr>
          </table>

          <h4>Amplicons</h4>
          <table id="amplicontable" class="table table-bordered table-hover table-condensed">
              <thead>
                  <th tal:repeat="header amplicon_headers">${header}</th>
              </thead>
              <tr tal:repeat="row amplicon_rows">
                  <td tal:repeat="cell row">${cell}</td>
              </tr>
          </table>
          <h4>Layout</h4>
          <table id="layouttable" class="table table-bordered table-hover table-condensed">
              <thead>
                  <th tal:repeat="header layout_headers">${header}</th>
              </thead>
              <tr tal:repeat="row layout_rows">
                  <td tal:repeat="cell row">${cell}</td>
              </tr>
          </table>
        </div>

        <!-- Setup section ************************************************* -->
        <div role="tabpanel" class="tab-pane" id="setup">
          <h3>Setup</h3>
          <h4>Upload project data and layout</h4>
          <p>
              Load targets, guides, amplicons, and layout from an Excel file
              using <a href="${request.route_url('home')}static/GEPXXXXX.xlsx">this template</a>.
          </p>
          <form action="${request.route_url('project', gepid=project.geid)}" method="post" accept-charset="utf-8" enctype="multipart/form-data" class="form-inline">

            <!-- div class="form-group">
              <label class="btn btn-default" for="file">
                <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> Select file
                <input type="file" id="upload" name="layoutfile" style="visibility:hidden;"></input>
              </label>
              <label class="btn btn-default" for="submit">
                <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span> Upload
                <input data-toggle="modal" data-target="#myModal" type="submit" name="submit_project_data" style="visibility:hidden;"></input>
              </label>
            </div -->
            <div class="form-group">
              <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
              <label class="btn btn-default btn-file">
                <input type="file" id="upload" name="layoutfile" value=""></input>
              </label>
            </div>
            <input class="btn btn-default" data-toggle="modal" data-target="#myModal" type="submit" name="submit_project_data" value="Upload"></input>
          </form>
          <!-- Modal content -->
          <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Loading project ${project.geid} data</h4>
                  </div>
                  <div class="modal-body">
                    <p>Loading data and retriving amplicon sequences from reference genome take some time. Thanks for your patience.</p>
                    <div class="progress">
                      <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                          aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%; height: 40px">
                      </div>
                    </div>
                  </div>
              </div>
            </div>
          </div>

        </div>

        <!-- Reads section ************************************************* -->
        <div role="tabpanel" class="tab-pane" id="reads">
          <h3>Reads</h3>
          <h4>Amplicon Read Coverage plot(s)</h4>
          <div tal:condition="coverageplot">
              ${structure: coverageplot}
          </div>
          <h4>Amplicon Read Coverage in table</h4>
        </div>

        <!-- Variants section ********************************************** -->
        <div role="tabpanel" class="tab-pane" id="variants">
          <h3>Variants</h3>
          <h4>Variant Impact Frequency plot(s)</h4>
          <div tal:condition="impactplot">
              ${structure: impactplot}
          </div>
          <h4>Variant Impact Frequency in table</h4>
        </div>

        <!-- Scores section ************************************************ -->
        <div role="tabpanel" class="tab-pane" id="scores">
          <h3>Scores</h3>
          <h4>KO Scores on plate(s)</h4>
          <div tal:condition="heatmapplot">
              ${structure: heatmapplot}
          </div>
          <h4>Scores in table</h4>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(
    function() {
        $('#projecttable').DataTable( {
          "searching": false,
          "paging":    false,
          "ordering":  false,
          "info":      false,
          "columnDefs": [ {
            "targets": [ 8 ],
            "visible": false,
            "searchable": false
            }, {
            "targets": [ 9 ],
            "visible": false,
            "searchable": false
            }, {
            "targets": [ 10 ],
            "visible": false,
            "searchable": false
            }, {
            "targets": [ 11 ],
            "visible": false,
            "searchable": false
            },
          ]
        } );

        $('#targettable').DataTable({
          "searching": false,
          "paging":    false,
          "info":      false,
          "columnDefs": [ {
            "targets": [ 8 ],
            "visible": false,
            "searchable": false
            },
          ]
        } );

        $('#guidetable').DataTable({
          "searching": false,
          "paging":    false,
          "info":      false,
        } );

        $('#amplicontable').DataTable({
          "searching": false,
          "paging":    false,
          "info":      false,
          "columnDefs": [ {
            "targets": [ 11 ],
            "visible": false,
            "searchable": false
            }, {
            "targets": [ 12 ],
            "visible": false,
            "searchable": false
            },
          ]
        } );

        $('#layouttable').DataTable({
          "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
        } );

        $('#guidemismatchtable').DataTable({
        } );
        <!--
        $('#vvariantdatatable').DataTable({
          "aaSorting": [[4, 'asc']],
          "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
          "dom": "<'row'<'col-sm-4'l><'col-sm-2'B><'col-sm-6'f>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-5'i><'col-sm-7'p>>",
          "buttons": [ {text: 'Export to CSV', extend:'csvHtml5'} ],
          "columnDefs": [
            { "targets": 7,
              "data": "view_link",
              "render": function ( data, type, full, meta ) {
                return '<a href="'+data+'">view</a>';
              }
            },
            { "targets": 8,
              "data": "download_link",
              "render": function ( data, type, full, meta ) {
                return '<a href="'+data+'">download</a>';
              }
            }
          ]
        } );
        -->
        <!--
        $('#sampledatatable').DataTable({
          "aaSorting": [[14, 'desc']],
          "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
          "dom": "<'row'<'col-sm-4'l><'col-sm-2'B><'col-sm-6'f>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-5'i><'col-sm-7'p>>",
          "buttons": [ {text: 'Export to CSV', extend:'csvHtml5'} ]
        } );
        -->
        <!--
        $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
          $($.fn.dataTable.tables(true)).DataTable()
             .columns.adjust()
             .responsive.recalc();
        } );
      -->
    } );
</script>
