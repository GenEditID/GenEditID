<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n">

<div metal:use-macro="load: layout.pt">
  <div id="content" metal:fill-slot="content">
    <div class="content">
      <div class="container-fluid">
        <h1>${title}</h1>

        <h2>Projects</h2>
        <div id="ProjectData"></div>
        <table id="project-data" class="table table-hover table-condensed">
            <thead>
                <th tal:repeat="header column_headers">${header}</th>
            </thead>
            <tr tal:repeat="row rows">
                <td tal:repeat="cell row">${cell}</td>
            </tr>
        </table>
        <hr/>

        <h2>Create new project</h2>
        <p>
            Load a new project and its experiment layout from an Excel file
            using <a href='static/YYYYMMDD_GEPXXXXX.xlsx'>this template</a>.
        </p>
        <form action="${request.route_url('home')}" method="post" accept-charset="utf-8" enctype="multipart/form-data" class="form-inline">
          <div tal:condition="clash">
              <p>
                  <span class='warning'>Warning!</span> The project that you are uploading, ${clash.key}, already exists.
              </p>
              <p>
                  Set this check box to remove the existing project,
                  select file again and upload.
                  <input name="blat" type="checkbox" value="true"></input>
              </p>
          </div>
          <div class='error' tal:condition="error">
              <p>
                  Error: ${error}
              </p>
          </div>
          <div class="form-group">
            Select file:
            <label class="btn btn-default btn-file">
              <input type="file" id="upload" name="layoutfile" value=""></input>
            </label>
          </div>
          <input class="btn btn-default" type="submit" name="submit" value="Upload"></input>
          <p>
              Loading data can take a few seconds. Thanks for your patience.
          </p>
        </form>
        <hr/>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" charset="utf-8">
  $(document).ready (
    function() {
        $('#project-data').DataTable ( {
          "columnDefs": [ {
             "targets": 1,
             "data": "view_link",
             "render": function ( data, type, full, meta ) {
               return '<a href="'+data+'">view/edit</a>';
             }
           } ],
           "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
        } );
    } );
</script>
