<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n">

<div metal:use-macro="load: layout.pt">
    <div id="content" metal:fill-slot="content">
        <div class="content">

            <h1>${title}</h1>

            <h2>Projects</h2>
            <div id="ProjectData"></div>
            <table id="project-data">
                <thead>
                    <th tal:repeat="header column_headers">${header}</th>
                </thead>
                <tr tal:repeat="row rows">
                    <td tal:repeat="cell row">${cell}</td>
                </tr>
            </table>
            <hr/>

            <h2>Create new project</h2>
            <p>
                Load a new project and its experiment layout from an Excel file
                using the <a href='static/YYYYMMDD_GEPXXXXX.xlsx'>appropriate template</a>.
            </p>
            <p tal:condition="not clash">
                Warning! If the project already exists it will be replaced.
            </p>
            <form action="${request.route_url('home')}" method="post" accept-charset="utf-8" enctype="multipart/form-data">
                <div tal:condition="clash">
                    <p>
                        The project that you are loading, ${clash.key}, already exists.
                    </p>
                    <p>
                        Set this check box to remove the existing project and
                        create it again.
                        <input name="blat" type="checkbox" value="true"></input>
                    </p>
                </div>
                <div tal:condition="error">
                    <p>
                        Error: ${error}
                    </p>
                </div>
                <p>
                    <label for="upload">Select file:</label>
                    <input id="upload" name="layoutfile" type="file" value=""></input>
                    <input type="submit" name="submit" value="Upload"></input>
                </p>
                <p>
                    Loading data can take a few seconds. Please be patient.
                </p>
            </form>
            <hr/>

        </div>
    </div>
</div>
<script type="text/javascript" charset="utf-8">
  $(document).ready(
      function()
      {
          $('#project-data').DataTable(
          {
            "columnDefs": [
            {
               "targets": 1,
               "data": "view_link",
               "render": function ( data, type, full, meta ) {
                 return '<a href="'+data+'">view</a>';
               }
             } ]
          });
      }
  );
</script>
